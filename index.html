<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>Checklist Camión PLBD87</title>
    <!-- Tailwind CSS para el diseño profesional -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap');
        
        body { 
            font-family: 'Inter', sans-serif; 
            background-color: #f8fafc;
        }

        /* Estilos para el reporte de impresión (Word Style) */
        @media print {
            .no-print { display: none !important; }
            .print-only { display: block !important; }
            body { background: white !important; padding: 0; margin: 0; }
            #report-container { display: block !important; width: 100%; }
        }

        .print-only { display: none; }
        
        /* Checkbox personalizado */
        .custom-checkbox {
            width: 28px;
            height: 28px;
            border: 2px solid #cbd5e1;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }
        .custom-checkbox.checked {
            background-color: #10b981;
            border-color: #10b981;
        }
    </style>
</head>
<body class="text-slate-900">

    <!-- CONTENIDO DE LA APLICACIÓN (NO SE IMPRIME) -->
    <div id="app-ui" class="no-print min-h-screen pb-10">
        <header class="bg-white border-b sticky top-0 z-30 px-4 py-4 shadow-sm">
            <div class="max-w-xl mx-auto flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="bg-blue-600 p-2 rounded-xl text-white">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10 17h4V5H2v12h3m15 0h2v-3.34a4 4 0 0 0-1.17-2.83L19 9h-5v8h1"/><circle cx="7" cy="17" r="2"/><circle cx="17" cy="17" r="2"/></svg>
                    </div>
                    <div>
                        <h1 class="font-black text-xl leading-none">PLBD87</h1>
                        <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">Entrega Diaria</p>
                    </div>
                </div>
                <button onclick="exportar()" class="bg-slate-900 text-white px-5 py-2.5 rounded-xl text-sm font-bold shadow-lg active:scale-95 transition-transform flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    Exportar
                </button>
            </div>
        </header>

        <main class="max-w-xl mx-auto px-4 mt-6">
            <!-- Info Card -->
            <div class="bg-white rounded-3xl p-5 shadow-sm border border-slate-100 mb-6 flex justify-between items-center text-sm font-bold text-slate-600">
                <div id="display-date">Cargando fecha...</div>
                <div id="display-time">00:00</div>
            </div>

            <!-- Lista de Items -->
            <div id="checklist-container" class="space-y-4 mb-8">
                <!-- Los items se cargarán aquí por JavaScript -->
            </div>

            <!-- Agregar Item -->
            <div class="bg-white rounded-3xl p-6 border-2 border-dashed border-slate-200">
                <h3 class="text-xs font-black text-blue-600 uppercase tracking-widest mb-4">Añadir otro parámetro</h3>
                <div class="flex gap-2">
                    <input type="text" id="new-item-input" placeholder="Nombre del parámetro..." class="flex-1 bg-slate-50 border-none rounded-xl px-4 py-3 text-sm font-semibold outline-none focus:ring-2 focus:ring-blue-500">
                    <button onclick="addItem()" class="bg-blue-600 text-white p-3 rounded-xl shadow-md active:scale-90">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    </button>
                </div>
            </div>
        </main>
    </div>

    <!-- REPORTE DE IMPRESIÓN (Word Style) -->
    <div id="report-container" class="print-only p-10 bg-white min-h-screen text-slate-900">
        <div class="max-w-4xl mx-auto border-2 border-slate-200 p-8">
            <div class="flex justify-between items-end border-b-4 border-slate-900 pb-6 mb-8">
                <div>
                    <h1 class="text-3xl font-black uppercase">Entrega de Camión Diario</h1>
                    <div class="mt-2 inline-block bg-slate-900 text-white px-4 py-1 text-2xl font-mono font-bold rounded">PLBD87</div>
                </div>
                <div class="text-right text-sm font-bold">
                    <p id="report-date"></p>
                    <p id="report-time"></p>
                </div>
            </div>
            <div id="report-items-list" class="space-y-6">
                <!-- Se llena con JS -->
            </div>
            <div class="mt-20 grid grid-cols-2 gap-10 px-10 text-center">
                <div class="border-t-2 border-slate-900 pt-4 font-bold uppercase text-sm">Firma Operador</div>
                <div class="border-t-2 border-slate-900 pt-4 font-bold uppercase text-sm">Firma Supervisor</div>
            </div>
        </div>
    </div>

    <!-- Input de archivo oculto -->
    <input type="file" id="camera-input" accept="image/*" capture="environment" class="hidden">

    <script>
        // Estado inicial
        let items = [
            { id: 1, label: 'Luces del camión', checked: false, photo: null },
            { id: 2, label: 'Llaves de candado', checked: false, photo: null },
            { id: 3, label: 'Luz de carrocería', checked: false, photo: null },
            { id: 4, label: 'Candado 1', checked: false, photo: null },
            { id: 5, label: 'Candado 2', checked: false, photo: null }
        ];

        let activeItemId = null;

        // Actualizar reloj
        function updateClock() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('es-CL', { day: '2-digit', month: '2-digit', year: 'numeric' });
            const timeStr = now.toLocaleTimeString('es-CL', { hour: '2-digit', minute: '2-digit' });
            
            document.getElementById('display-date').innerText = dateStr;
            document.getElementById('display-time').innerText = timeStr;
            document.getElementById('report-date').innerText = 'Fecha: ' + dateStr;
            document.getElementById('report-time').innerText = 'Hora: ' + timeStr + ' hrs';
        }
        setInterval(updateClock, 1000);
        updateClock();

        // Renderizar Lista
        function render() {
            const container = document.getElementById('checklist-container');
            container.innerHTML = '';

            items.forEach(item => {
                const card = document.createElement('div');
                card.className = "bg-white rounded-[2rem] p-5 shadow-sm border border-slate-100";
                card.innerHTML = `
                    <div class="flex items-center justify-between gap-3 mb-4">
                        <div class="flex items-center gap-3 flex-1 cursor-pointer" onclick="toggleCheck(${item.id})">
                            <div class="custom-checkbox ${item.checked ? 'checked' : ''}">
                                ${item.checked ? '<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="4"><polyline points="20 6 9 17 4 12"/></svg>' : ''}
                            </div>
                            <span class="font-bold ${item.checked ? 'text-slate-300 line-through' : 'text-slate-700'}">${item.label}</span>
                        </div>
                        <button onclick="removeItem(${item.id})" class="text-slate-200 p-2 hover:text-red-500">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                        </button>
                    </div>
                    <div class="relative">
                        ${item.photo ? `
                            <div class="relative rounded-2xl overflow-hidden shadow-inner border border-slate-100">
                                <img src="${item.photo}" class="w-full h-48 object-cover">
                                <button onclick="removePhoto(${item.id})" class="absolute top-3 right-3 bg-red-500 text-white p-2 rounded-full shadow-lg">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                                </button>
                            </div>
                        ` : `
                            <button onclick="triggerCamera(${item.id})" class="w-full py-10 border-2 border-dashed border-slate-100 rounded-3xl flex flex-col items-center justify-center gap-2 text-slate-400 bg-slate-50/50 hover:bg-blue-50 transition-colors">
                                <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/><circle cx="12" cy="13" r="4"/></svg>
                                <span class="text-[10px] font-black uppercase tracking-widest">Sacar Foto</span>
                            </button>
                        `}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Lógica de cámara
        function triggerCamera(id) {
            activeItemId = id;
            document.getElementById('camera-input').click();
        }

        document.getElementById('camera-input').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file && activeItemId !== null) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    items = items.map(it => it.id === activeItemId ? {...it, photo: event.target.result, checked: true} : it);
                    render();
                };
                reader.readAsDataURL(file);
            }
            this.value = '';
        });

        // Acciones
        window.toggleCheck = (id) => {
            items = items.map(it => it.id === id ? {...it, checked: !it.checked} : it);
            render();
        };

        window.removePhoto = (id) => {
            items = items.map(it => it.id === id ? {...it, photo: null} : it);
            render();
        };

        window.removeItem = (id) => {
            items = items.filter(it => it.id !== id);
            render();
        };

        window.addItem = () => {
            const input = document.getElementById('new-item-input');
            const val = input.value.trim();
            if (val) {
                items.push({ id: Date.now(), label: val, checked: false, photo: null });
                input.value = '';
                render();
            }
        };

        // Exportar Reporte
        window.exportar = () => {
            const listContainer = document.getElementById('report-items-list');
            listContainer.innerHTML = '';

            items.forEach((item, index) => {
                const row = document.createElement('div');
                row.className = "flex gap-6 items-start pb-6 border-b border-slate-100 last:border-0";
                row.innerHTML = `
                    <div class="font-black text-slate-300 text-xl">${index + 1}</div>
                    <div class="flex-1">
                        <h3 class="text-lg font-bold uppercase">${item.label}</h3>
                        <p class="text-[10px] font-black uppercase ${item.checked ? 'text-emerald-600' : 'text-red-500'}">
                            ${item.checked ? 'Revisado ✓' : 'Pendiente ✗'}
                        </p>
                        <div class="mt-4 h-10 border-b border-dotted border-slate-200"></div>
                    </div>
                    <div class="w-48 h-32 bg-slate-50 border border-slate-200 rounded overflow-hidden flex items-center justify-center">
                        ${item.photo ? `<img src="${item.photo}" class="w-full h-full object-cover">` : '<span class="text-[8px] font-bold text-slate-300">SIN FOTO</span>'}
                    </div>
                `;
                listContainer.appendChild(row);
            });

            window.print();
        };

        // Inicio
        render();
    </script>
</body>
</html>

